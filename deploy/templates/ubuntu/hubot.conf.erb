# This file is maintained by chef - LOCAL CHANGES WILL BE LOST
#
# Rambot
#
# description "Rambot"
#
# start on filesystem or runlevel [2345]
# stop on runlevel [!2345]
#

env HUBOT_DIR="<%= @install_dir %>"
env HUBOT="/bin/hubot"
env ADAPTER="<%= @adapter %>"
env HUBOT_USER="<%= @user %>"

# httpd listen port
env PORT="<%= @port %>"

# irc-specific environment variables
# https://github.com/github/hubot/wiki/Adapter:-IRC
env HUBOT_IRC_NICK="<%= @irc['HUBOT_IRC_NICK'] %>"
env HUBOT_IRC_ROOMS="<%= @irc['HUBOT_IRC_ROOMS'] %>"
env HUBOT_IRC_SERVER="<%= @irc['HUBOT_IRC_SERVER'] %>"
env HUBOT_IRC_PASSWORD="<%= @irc['HUBOT_IRC_PASSWORD'] %>"
env HUBOT_IRC_UNFLOOD="<%= @irc['HUBOT_IRC_UNFLOOD'] %>"

# Keep the process alive, limit to 5 restarts in 60s
respawn
respawn limit 5 60

exec start-stop-daemon --start --chuid ${HUBOT_USER} --chdir ${HUBOT_DIR} \
  --exec ${HUBOT_DIR}${HUBOT} -- --name ${HUBOT_USER} --adapter ${ADAPTER}  >> /var/log/hubot.log 2>&1
